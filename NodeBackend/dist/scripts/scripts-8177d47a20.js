"use strict";angular.module("menuApp",["ngMaterial","ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ui.router","vcRecaptcha"]).config(["$stateProvider","$urlRouterProvider","$sceDelegateProvider",function(e,t,r){t.otherwise("/cart"),e.state("root",{url:"",templateUrl:"views/mainView.html",controller:"mainController",controllerAs:"vm",abstract:!0}).state("root.cart",{url:"/cart",templateUrl:"views/cartView.html",controller:"cartController",controllerAs:"vm"}).state("root.history",{url:"/history",templateUrl:"views/historyView.html",controller:"historyController",controllerAs:"vm"}).state("root.menu",{url:"/menu",templateUrl:"views/menuView.html",controller:"menuController",controllerAs:"vm"}),r.resourceUrlWhitelist(["self","http://localhost:5000/**"])}]),angular.module("menuApp").factory("httpService",["$http",function(e){return{backendAddress:"http://localhost:5000",getDish:function(t){return e({url:this.backendAddress+"/api/getDish?dishId="+t,method:"GET"}).then(function(e){return e},function(e){return e})},retrieveMenu:function(){return e({url:this.backendAddress+"/api/menu",method:"GET"}).then(function(e){return e},function(e){return e})},retrieveHistory:function(t){return e({url:this.backendAddress+"/api/retrieveHistory",method:"POST",data:t,headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},sendOrder:function(t){return e({url:this.backendAddress+"/api/sendOrder",method:"POST",data:t,headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},requestAuthentication:function(t){return e({url:this.backendAddress+"/api/requestAuthentication",method:"POST",data:t,headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},resetPassword:function(t){return e({url:this.backendAddress+"/api/resetPassword",method:"POST",data:t,headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})}}}]),angular.module("menuApp").factory("stateShareService",function(){return{menu:[],order:{},orderLength:0,orderPrice:0,menuRetrieved:!1,historyRetrieved:!1,history:{},expandLatest:!1}}),angular.module("menuApp").controller("menuController",["httpService","stateShareService",function(e,t){var r=this;r.menu=t.menu,r.retrieveMenu=function(){e.retrieveMenu().then(function(e){if(e.data.err)return void window.alert(e.data.err);t.menu=e.data,r.menu=e.data,t.menuRetrieved=!0})},t.menuRetrieved||r.retrieveMenu(),r.addDish=function(e){t.orderLength++,t.orderPrice=(parseFloat(t.orderPrice)+parseFloat(e.price)).toFixed(2),void 0===t.order[e.itemID]?(e.count=1,t.order[e.itemID]=e):t.order[e.itemID].count++}}]),angular.module("menuApp").config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self","http://localhost:5000/**"])}]),angular.module("menuApp").controller("cartController",["$scope","httpService","stateShareService","$mdDialog",function(e,t,r,n){var o=this;o.basketPrice=r.orderPrice,o.basket=r.order,o.orderLength=r.orderLength,o.removeDishSingle=function(e){o.basket[e.itemID].count-=1,0===o.basket[e.itemID].count&&delete o.basket[e.itemID],r.orderPrice=(parseFloat(r.orderPrice)-parseFloat(e.price)).toFixed(2),r.orderLength--},o.addDishSingle=function(e){o.basket[e.itemID].count+=1,r.orderPrice=(parseFloat(r.orderPrice)+parseFloat(e.price)).toFixed(2),r.orderLength++},o.removeDishAll=function(e){r.orderPrice=(parseFloat(r.orderPrice)-parseFloat(parseFloat(e.price)*e.count)).toFixed(2),r.orderLength-=e.count,delete o.basket[e.itemID]},o.showPrompt=function(){if(0==r.orderLength)return void window.alert("Cart is empty!");n.show({controller:"cartAuthController",templateUrl:"views/extra/cartAuthDialogView.html"})},e.$watch(function(){return r.orderPrice},function(){o.basketPrice=r.orderPrice}),e.$watch(function(){return r.orderLength},function(){o.orderLengt=r.orderLength})}]),angular.module("menuApp").controller("historyController",["httpService","stateShareService","$mdDialog",function(e,t,r){var n=this;n.history=t.history,n.historyRetrieved=t.historyRetrieved,n.authPhoneNumber="",n.authPassword="",t.expandLatest&&(n.history[0].expanded=!0,t.expandLatest=!1),n.toggleOrder=function(e){for(var t=0;t<n.history.length;t++)n.history[t].expanded=t===e&&!n.history[t].expanded},n.setRetrieved=function(){n.historyRetrieved=!n.historyRetrieved,t.historyRetrieved=n.historyRetrieved},n.retrieveHistory=function(){n.history=[];var t={phoneNumber:n.authPhoneNumber,password:n.authPassword};e.retrieveHistory(t).then(function(e){if(e.data.err)return void window.alert(e.data.err);n.history=e.data.orders,n.setRetrieved()})},n.showPrompt=function(){r.show({controller:"passwordResetController",templateUrl:"views/extra/passwordResetDialogView.html"})}}]),angular.module("menuApp").controller("cartAuthController",["$scope","$mdDialog","$state","vcRecaptchaService","httpService","stateShareService",function(e,t,r,n,o,i){e.siteKey="6LdCmh0UAAAAAOCCmuEpb8C0edrrl6kgl3x7MBJ0",e.phoneNumber=null,e.phoneCode=null,e.response=null,e.widgetId=null,e.showPhone=!0,e.showCode=!1,e.changeState=function(){e.showPhone=e.showCode,e.showCode=!e.showPhone},e.closeDialog=function(){t.hide()},e.setWidgetId=function(t){e.widgetId=t},e.setResponse=function(t){e.response=t},e.cbExpiration=function(){n.reload(e.widgetId),e.response=null},e.requestCode=function(){var t={phoneNumber:e.phoneNumber,recaptcha:e.response};o.requestAuthentication(t).then(function(t){e.changeState()})},e.sendOrder=function(){var n={phoneCode:e.phoneCode,order:i.order,phoneNumber:e.phoneNumber};o.sendOrder(n).then(function(e){e.data.orders.length>0&&(t.hide(),i.history=e.data.orders,i.historyRetrieved=!0,i.expandLatest=!0,r.go("root.history"))})}}]),angular.module("menuApp").directive("menuItemDirective",function(){return{scope:{imageLink:"@",title:"@",count:"@",price:"@",addDishFn:"&"},templateUrl:"views/directives/menuItemDirective.html",link:function(e,t,r){e.imageLink=r.imagelink}}}),angular.module("menuApp").directive("cartItemDirective",function(){return{scope:{imageLink:"@",title:"@",count:"@",price:"@",removeFn:"&",addFn:"&",removeAllFn:"&"},templateUrl:"views/directives/cartItemDirective.html",link:function(e,t,r){e.imageLink=r.imagelink,e.parsePrice=function(){return parseFloat(parseFloat(e.price)*e.count).toFixed(2)}}}}),angular.module("menuApp").directive("orderItemDirective",function(){return{scope:{imageLink:"@",title:"@",count:"@",price:"@"},templateUrl:"views/directives/orderItemDirective.html",link:function(e,t,r){e.imageLink=r.imagelink,e.parsePrice=function(){return parseFloat(parseFloat(e.price)*e.count).toFixed(2)}}}}),angular.module("menuApp").controller("mainController",["$rootScope","$scope","stateShareService","$state",function(e,t,r,n){var o=this;o.state="cart",o.itemsCount=r.orderLength,t.$on("stateChange",function(e,t){o.state=t}),t.$watch(function(){return r.orderLength},function(){o.itemsCount=r.orderLength})}]),angular.module("menuApp").controller("passwordResetController",["$scope","$mdDialog","vcRecaptchaService","httpService","stateShareService",function(e,t,r,n,o){e.siteKey="6LdCmh0UAAAAAOCCmuEpb8C0edrrl6kgl3x7MBJ0",e.phoneNumber=null,e.response=null,e.widgetId=null,e.closeDialog=function(){t.hide()},e.setWidgetId=function(t){e.widgetId=t},e.setResponse=function(t){e.response=t},e.cbExpiration=function(){r.reload(e.widgetId),e.response=null},e.resetPassword=function(){var t={phoneNumber:e.phoneNumber,recaptcha:e.response};n.resetPassword(t).then(function(t){e.closeDialog()})}}]);